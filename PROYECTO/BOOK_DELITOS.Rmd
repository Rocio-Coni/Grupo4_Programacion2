---
title: "ANALISIS DE CLUSTER"
author: 
- name: "Conislla Huamanyalli Rocio"
- name: "Coba Bautista Kevin"
- name: "Chavez Chipana Joel"
- name: "Silvestre Jimenez Brenda"
- name: "Tuanama Satalaya Pierina"
date: "11/09/2021"
output: bookdown::gitbook
site: bookdown::bookdown_site
documentclass: book
biblio-style: apalike
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, psych, PerformanceAnalytics, GGally, rgl, DT,
               lattice, cptcity, ade4, factoextra, cluster, corrplot,
               NbClust, LICORS, clusterSim, clValid, kableExtra, ggdark,
               mice , VIM , reshape2)
```
# PRESENTACIÓN
El siguiente trabajo se basa en  análisis de componentes principales, el cual es una técnica que se usó para describir nuestro conjunto de datos criminalísticos en términos de nuevas variables o componentes Los componentes se ordenan por la cantidad de varianza original que describen, por lo que la técnica es útil para reducir la dimensionalidad de un conjunto de datos.


# INTRODUCCIÓN
La inseguridad ciudadana en nuestro país es, lamentablemente, un problema grave, complejo y aparentemente crónico, sobre el cual, ahora todos comentamos, opinamos, criticamos, pero que realmente, muy pocos conocemos y participamos proactivamente; y es asi que vemos con temor como este fenómeno social sigue permanentemente afectando la paz y tranquilidad de los peruanos y más aún, condenando el desarrollo y bienestar nacional.
La inseguridad ciudadana surge como un fenómeno y problema social en la actualidad, en sociedades como la peruana, que poseen un diverso nivel de desarrollo económico, múltiples rasgos culturales y regímenes políticos de distinto signo, no pudiéndose establecer, por tanto, distinciones simplistas para caracterizar factores asociados a su incremento y formas de expresión.
Una de las formas que podemos realizar para contemplar la correlación existente entre las variables más importantes sobre inseguridad ciudadana es la técnica llamada análisis de componentes principales (PCA), la cual nos permite pasar nuestras variables descargadas de la página DATACRIM, que es el sistema integrado de  estadísticas de la criminalidad y seguridad ciudadana, que maneja datos provistos por el INEI y la Policía Nacional del Perú.
El PCA nos permite pasar nuestras variables que están correlacionadas, a pocas componentes principales, de este modo, con unas pocas combinaciones lineales, que serán las componentes principales, sería suficiente para entender la información contenida en nuestros datos.
Al mismo tiempo, la forma en que se construyen las componentes, y su relación con unas u otras de las variables originales, sirven para entender la estructura de correlación inherente a los datos. Por último, las componentes principales, que forman un vector aleatorio de dimensión menor, pueden ser empleadas en análisis estadísticos posteriores

# OBJETIVOS
•	Transformar el conjunto de variables de criminalidad (variables originales) en un nuevo conjunto de variables (componentes principales), incorrelacionadas entre sí.

•	Facilitar la interpretación de la data de criminalística, para que pueda ser utilizado en investigaciones futuras.

•	Clusterizar y encontrar diferencias entre nuestras variables


# ADQUISICION DE DATOS
## Fuente de Data
![Fuente: INEI](DataCRIM.png)
Para la realización del siguiente proyecto se indago sobre delitos, para ellos atreves de la pagina de INEI se sustrajo información sobre Delitos a nivel de regiones, en esta información se trabajo con los delitos totales atreves de las penitenciarias y en el rango de año 2011-2019.


## Descripción Variables
![Fuente: Elaboracion Propia](DescripcionVariable.png)

# PROCESO DE ANÁLISIS DE LOS DATOS
## Análisis Exploratorio de Datos
Para el presente análisis usamos la data descargada anteriormente, las cuales exploraremos y ordenaremos adecuadamente dichos datos.

### Importamos los datos
Cargamos los datos crudos y visualizamos los datos en desorden, y con valores NA, las cuales limpiamos y tranformamos.
```{r error=TRUE}
data0 <- read.csv("DEPARTAMENTOS (1) - copia.csv", sep = ";")
tibble(data0)
# saveRDS(data0, file = "data0RDS.RDS")
```

Primeramente reducimos el nombre de nuestras variables paara una mejor visualización

```{r}
names(data0) <- c("Dep","Pob","NEP",
                  "S_F","S_M","SNE",
                  "NE_I","NE_PC","ND_PI",
                  "NE_SC","NE_SI","NE_SnUC",
                  "NE_SnUI","NE_SUC","NE_SUI",
                  "NE_Pstgr","NE_NAp","DcP",
                  "DcSegP","DcL","DcVCS",
                  "DcF","DcAP","DcTP",
                  "DcOFM","DcFP","Dt",
                  "DcCBFN","DcH","Otros",
                  "E_18_19","E_20_24","E_25_29",
                  "E_30_34","E_35_39","E_40_44",
                  "E_45_49","E_50_59","E_60_")

#View(data0)
tibble(data0)
```


### Eliminar NA 

Se evalua los Missing Values en la data ya que no deben ser el mayor porcentaje del total.

```{r}
data0 %>% mice::md.pattern(rotate.names=TRUE)
#data0 %>% VIM::aggr(numbers=T, sortVar=T )
```

Observando el grafico, se entiende que para la primera fila hay una observacion que tiene NA en la variable DcH en la segunda fila,hay una observacion que tiene NA en DcBFN y DcH, así sucesivamente hasta llegar a la ultima fila, donde una observacion tiene 26 NA, el cual definitivamente se eliminara.


### Eliminar filas

Las variables principales que son sustento base de que existen los datos y son reales, vienen a ser cinco, la variable poblacion, establecimientos penitenciarios, mujeres y varones, es por ello que si alguno no tiene datos, procedera a ser eliminado

```{r}
data0 <- data0[!is.na(data0$Pob),]
data0 <- data0[!is.na(data0$NEP),]
data0 <- data0[!is.na(data0$S_F),]
data0 <- data0[!is.na(data0$S_M),]

tibble(data0) %>% print(n=26)
```

Como se observa, la cantidad de departamentos se redujo, se elimino al Callao, Moquegua y Madre de Dios

### Eliminar columnas
Teniendo todos los departamentos con la data principal, se procede a analizar las varibles, teniendo en cuenta que no podemos trabajar con NA,se procedera a eliminar aquellas columnas que la contengan. 

Examinamos cuantos NA tiene cada columna para darnos una idea
```{r}
sapply(data0, function(x) sum(is.na(x))) #numero de nulos por columnas
```

Eliminamos todas las columnas que tienen al menos un NA
```{r}
colMeans(is.na(data0))
data1 <- data0[,-which(colMeans(is.na(data0)) > 0)]
tibble(data1) %>% print(n=26)
#View(data1)
```

De 39 variables se eliminaron 10. Ahora verificamos que nuestra data no tenga NA
```{r}
data1 %>% mice::md.pattern(rotate.names=TRUE) #verificando que no hay NA
```

### Gráfico resumen 
Mostramos porcentaje de Delitos en todo el Perú, después de la limpieza de datos.
```{r}
#glimpse(data1)
total <- dplyr::select(data1,15:20)
suma <- colSums (total)
porcent <- cbind(suma,prop = prop.table(suma))*100
grafico <- data.frame(porcent)
grafico
etiquetas <- c("48.25% DcP","22.52% DcSegP","17.09% DcL","8.75% DcVCS","2.08% DcF","1.27% DcAP")

pie(grafico$prop , col=rainbow(length(grafico$prop)), 
    labels = etiquetas,
    main = "Delitos en Perú",
    sub = "Evaluación de la cantidad de delitos registrados por tipo.")

legend("topleft", 
       c("D. C. patrominio",
         "D. C. la seguridad publica",
         "D. C. la libertad",
         "D. C. la vida, el cuerpo y la salud",
         "D. C. la familia",
         "D. C. la administracion publica"),
       cex = 0.5,
       fill = rainbow(length(grafico$prop)))
```

En el grafico observamos que el Delito contra el patrimonio es el que mas se da a nivel Nacional, seguido por el Delito contra la seguridad publica, estos dos abarcan casi el 70% del total ya que van de la mano, la inseguridad en las calles genera robos, extorsion, etc

Mostramos porcentaje del nivel de educaciòn 

```{r}
educacion <- dplyr::select(data1,6:14)
tot <- colSums(educacion)
perEDUC<- (cbind(tot,percent = prop.table(tot))*100) %>% 
  data.frame() %>% summarise(etiquet = c ("SNE",
                                          "NE_PC",
                                          "NE_PI",
                                          "NE_SC",
                                          "NE_SI",
                                          "NE_SnUC",
                                          "NE_SnIU",
                                          "NE_SUC",
                                          "NE_SUI"),
                             percent=round(percent,2),
                             total = tot, 
                             leyd = sprintf("%1s( %1s)" ,etiquet, percent))
pie(perEDUC$percent , col=rainbow(length(perEDUC$percent)), 
    labels = perEDUC$leyd,
    main = "Delitos en Perú segùn nivel de estudio",
    sub = "Evaluación según nivel de estudio")
legend("topleft", 
       perEDUC$etiquet,
       cex = 0.5,
       fill = rainbow(length(perEDUC$percent)))
```
En el grafico observamos que el nivel de estudio en el que se comete mas delitos son aquellas personas con secundaria incompleta (32.26%) , seguido de las personas con secundaria completa(27.45 %), mientras que el mas bajo son aquel grupo sin nivel de educaciòn.

Mostramos los datos segun rango de edad

```{r}
edades <- dplyr::select(data1, 21:28)
totale <- edades %>% colSums()

perEDAD<- (cbind(totale,percent = prop.table(totale))*100) %>% 
  data.frame() %>% summarise(etiquet = c ("E_18_19",
                                          "E_20_24",
                                          "E_25_29",
                                          "E_30_34",
                                          "E_35_39",
                                          "E_40_44",
                                          "E_45_49",
                                          "E_50_59"),
                             percent=round(percent,2),
                             total = totale, 
                             leyd = sprintf("%1s( %1s)" ,etiquet, percent))
pie(perEDAD$percent , col=rainbow(length(perEDAD$percent)), 
    labels = perEDAD$leyd,
    main = "Delitos en Perú segùn rango de edad",
    sub = "Evaluación según rango de edad")
legend("topleft", 
       perEDAD$etiquet,
       cex = 0.5,
       fill = rainbow(length(perEDAD$percent)))
```

En el grafico observamos que los rangos de edades en los que se comete màs delitos son los comprendidos entre 25 y 29 años con 18.83%, seguido de las edades comprendidas entre 30 y 34 años, mientras que el porcentaje mas bajo con 1.6% son el grupo comprendido entre los 18-19 años .

### Anlizando las variables

Analizemos segun sexo
```{r message=FALSE, warning=FALSE}
sexo <- dplyr::select(data1,1,4:5)
ki<- melt(sexo)
ggplot(data = ki , mapping = aes(x = Dep, y= value , fill= variable))+
  geom_col(position="dodge")+ # el valor de la observacion es el de la barra
  labs(title = "Comparaciòn por sexo",
       x = "Departamento",
       y = "valor")+
  theme(axis.text.x = element_text(angle = 20, size = 6,hjust = 1, vjust = 1))
```
En el gràfico podemos observar que el numero de varones es mucho mayor que las mujeres en todos los departamentos. 

Tipo de delito 

```{r message=FALSE, warning=FALSE}
delit<- data1 %>% dplyr::select(1,15:20) %>% 
    pivot_longer(-Dep, names_to = "delitos", values_to = "Valor") %>% 
  group_by(delitos) %>% 
  summarise(delitos,Valor, Dep)
ggplot(delit , mapping = aes( x = delitos , y = Valor , fill = delitos))+
  stat_boxplot(geom = "errorbar", # Error bars
               width = 0.25) +    # Bars width
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1)+
  ggtitle ("Evaluacion de delitos \nSegun el tipo de delito")+
  theme(panel.background = element_rect(fill = "beige"),
        plot.title = element_text(family="Comic Sans MS",
                                  size=rel(2), #Tamaño relativo de la letra del título
                                  vjust=2, #Justificación vertical, para separarlo del gráfico
                                  face="bold", #Letra negrilla. Otras posibilidades "plain", "italic", "bold" y "bold.italic"
                                  color="blue", #Color del texto
                                  lineheight=1.5))+
  scale_fill_hue(labels =c("D. C. la administracion publica",
                               "D. C. la familia",
                               "D. C. la libertad",
                               "D. C. patrominio",
                               "D. C. la seguridad publica",
                               "D. C. la vida, el cuerpo y la salud"))

ggplot(delit, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = delitos)) +
  labs(title = "Distribuciòn de delitos segùn tipo",
       y = "Tipo de delito") +
facet_grid(vars(delitos))

```



Nivel de Educaciòn
```{r message=FALSE, warning=FALSE}
educ<- data1 %>% dplyr::select(1,6:14) %>% 
  pivot_longer(-Dep, names_to = "N.educ", values_to = "Valor") %>% 
  group_by(N.educ) %>% 
  summarise(N.educ,Valor, Dep)

  ggplot( educ, mapping = aes( x = N.educ , y = Valor , fill = N.educ))+
  stat_boxplot(geom = "errorbar",
               width = 0.25) + 
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1) + # Color atípicos
  theme(
    panel.background = element_rect(fill = "beige")
  )

ggplot(educ, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = N.educ)) +
  labs(title = "Distribuciòn de delitos segùn nivel de educaciòn",
       y = "Nivel de educaciòn") +
facet_grid(vars(N.educ))

```

Analicemos la edad

```{r message=FALSE, warning=FALSE}
edad1 <-data1 %>% dplyr::select(1,21:28) %>%
  pivot_longer(-Dep, names_to = "edad", values_to = "Valor") %>% 
  group_by(edad) %>% 
  summarise(edad,Valor, Dep) 

  ggplot(edad1, mapping = aes( x = edad , y = Valor , fill = edad))+
  stat_boxplot(geom = "errorbar",
               width = 0.25) + 
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1) + 
  ggtitle ("Evaluacion de delitos \nSegun grupo de edad")+# Color atípicos
  theme(
    panel.background = element_rect(fill = "beige"),
    plot.title = element_text(family="Comic Sans MS",
                              size=rel(2), #Tamaño relativo de la letra del título
                              vjust=2, #Justificación vertical, para separarlo del gráfico
                              face="bold", #Letra negrilla. Otras posibilidades "plain", "italic", "bold" y "bold.italic"
                              color="blue", #Color del texto
                              lineheight=1.5)
  )
ggplot(edad1, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = edad)) +
  labs(title = "Distribuciòn de delitos segùn grupo de edad",
       y = "Grupo de edad") +
facet_grid(vars(edad))

```

**Analicemos la data sin Lima** 

```{r}
data2 <- data1[-14,]
```

Tipos de delitos

```{r}
delit2<- data2 %>% dplyr::select(1,15:20) %>% 
    pivot_longer(-Dep, names_to = "delitos", values_to = "Valor") %>% 
  group_by(delitos) %>% 
  summarise(delitos,Valor, Dep)
ggplot(delit2 , mapping = aes( x = delitos , y = Valor , fill = delitos))+
  stat_boxplot(geom = "errorbar", # Error bars
               width = 0.25) +    # Bars width
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1)+
  ggtitle ("Evaluacion de delitos \nSegun el tipo de delito")+
  theme(panel.background = element_rect(fill = "beige"),
        plot.title = element_text(family="Comic Sans MS",
                                  size=rel(2), #Tamaño relativo de la letra del título
                                  vjust=2, #Justificación vertical, para separarlo del gráfico
                                  face="bold", #Letra negrilla. Otras posibilidades "plain", "italic", "bold" y "bold.italic"
                                  color="blue", #Color del texto
                                  lineheight=1.5))+
  scale_fill_hue(labels =c("D. C. la administracion publica",
                               "D. C. la familia",
                               "D. C. la libertad",
                               "D. C. patrominio",
                               "D. C. la seguridad publica",
                               "D. C. la vida, el cuerpo y la salud"))

ggplot(delit2, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = delitos)) +
  labs(title = "Distribuciòn de delitos segùn tipo",
       y = "Tipo de delito") +
facet_grid(vars(delitos))
```
Nivel de Educaciòn
```{r message=FALSE, warning=FALSE}
educ2<- data2 %>% dplyr::select(1,6:14) %>% 
  pivot_longer(-Dep, names_to = "N.educ", values_to = "Valor") %>% 
  group_by(N.educ) %>% 
  summarise(N.educ,Valor, Dep)

  ggplot( educ2, mapping = aes( x = N.educ , y = Valor , fill = N.educ))+
  stat_boxplot(geom = "errorbar",
               width = 0.25) + 
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1) + # Color atípicos
  theme(
    panel.background = element_rect(fill = "beige")
  )

ggplot(educ2, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = N.educ)) +
  labs(title = "Distribuciòn de delitos segùn nivel de educaciòn",
       y = "Nivel de educaciòn") +
facet_grid(vars(N.educ))

```

Analicemos la edad

```{r message=FALSE, warning=FALSE}
edad2 <-data2 %>% dplyr::select(1,21:28) %>%
  pivot_longer(-Dep, names_to = "edad", values_to = "Valor") %>% 
  group_by(edad) %>% 
  summarise(edad,Valor, Dep) 

  ggplot(edad2, mapping = aes( x = edad , y = Valor , fill = edad))+
  stat_boxplot(geom = "errorbar",
               width = 0.25) + 
  geom_boxplot(alpha = 0.8,          # Transparencia
               colour = "#474747",   # Color del borde
               outlier.colour = 1) + 
  ggtitle ("Evaluacion de delitos \nSegun grupo de edad")+# Color atípicos
  theme(
    panel.background = element_rect(fill = "beige"),
    plot.title = element_text(family="Comic Sans MS",
                              size=rel(2), #Tamaño relativo de la letra del título
                              vjust=2, #Justificación vertical, para separarlo del gráfico
                              face="bold", #Letra negrilla. Otras posibilidades "plain", "italic", "bold" y "bold.italic"
                              color="blue", #Color del texto
                              lineheight=1.5)
  )
ggplot(edad2, mapping = aes(x = Valor)) +
  geom_histogram( aes(fill = edad)) +
  labs(title = "Dsitribuciòn de delitos segùn rango de edad",
       y = "Grupo de edad") +
facet_grid(vars(edad))

```

## Análisis de Componentes Principales
# RESULTADOS
# DISCUSION DE RESULTADOS
# CONCLUSIONES
# RECOMENDACIONES
# BIBLIOGRAFIA
